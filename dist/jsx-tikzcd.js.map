{"version":3,"file":"jsx-tikzcd.js","sources":["../src/h.js","../src/components.js","../src/render.js"],"sourcesContent":["export default function h(nodeName, attributes, ...children) {\r\n    let getChildren = children => children.reduce((acc, child) => {\r\n        if (child instanceof Array) {\r\n            acc.push(...getChildren(child))\r\n        } else {\r\n            acc.push(child)\r\n        }\r\n\r\n        return acc\r\n    }, [])\r\n\r\n    return {\r\n        nodeName,\r\n        attributes: attributes || {},\r\n        key: attributes && attributes.key,\r\n        children: getChildren(children)\r\n    }\r\n}\r\n","function getDirection([x1, y1], [x2, y2]) {\r\n    let [dx, dy] = [x2 - x1, y2 - y1]\r\n    let signs = [dx, dy].map(Math.sign)\r\n    let directions = [['l', '', 'r'], ['u', '', 'd']]\r\n\r\n    return [dx, dy].map((d, i) => directions[i][signs[i] + 1].repeat(Math.abs(d))).join('')\r\n}\r\n\r\nfunction renderEdge(vnode, co = false) {\r\n    if (vnode.attributes.direction == null) return ''\r\n\r\n    let p = !co === !!vnode.attributes.alt ? \"'\" : ''\r\n    let needWrapChars = ['\"', ',', ']']\r\n    let [w1, w2] = vnode.attributes.value != null\r\n        && needWrapChars.some(c => vnode.attributes.value.includes(c))\r\n        ? ['{', '}'] : ['', '']\r\n    let valueArg = vnode.attributes.value != null ? `\"${w1}${vnode.attributes.value}${w2}\"${p}` : null\r\n    let args = ['', valueArg, ...(vnode.attributes.args || [])].filter(x => x != null).join(', ')\r\n\r\n    return `\\\\arrow[${vnode.attributes.direction}${args}]`\r\n}\r\n\r\nexport const Node = () => {}\r\nexport const Edge = () => {}\r\n\r\nexport class Component {\r\n    constructor(props) {\r\n        this.props = props\r\n    }\r\n\r\n    render() {}\r\n}\r\n\r\nexport class Diagram extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        let getChildren = vnode => vnode.children.reduce((acc, v) => {\r\n            if (v == null) return acc\r\n\r\n            if ([Node, Edge].includes(v.nodeName)) {\r\n                acc.push(v)\r\n            } else {\r\n                acc.push(...getChildren(v))\r\n            }\r\n\r\n            return acc\r\n        }, [])\r\n\r\n        let children = getChildren(this.props)\r\n\r\n        this.nodes = children.reduce((acc, v) => {\r\n            if (v.nodeName !== Node || !v.key || !v.attributes.position)\r\n                return acc\r\n\r\n            if (!(v.key in acc)) acc[v.key] = v\r\n            else acc[v.key] = {\r\n                ...acc[v.key],\r\n                attributes: {\r\n                    ...acc[v.key].attributes,\r\n                    ...v.attributes\r\n                }\r\n            }\r\n\r\n            return acc\r\n        }, {})\r\n\r\n        this.edges = children.reduce((acc, v) => {\r\n            if (v.nodeName !== Edge || !v.attributes.from || !v.attributes.to)\r\n                return acc\r\n\r\n            let [from, to] = !props.co ? ['from', 'to'] : ['to', 'from']\r\n\r\n            if (!(v.attributes[from] in acc)) acc[v.attributes[from]] = []\r\n\r\n            acc[v.attributes[from]].push({\r\n                ...v,\r\n                attributes: {\r\n                    ...v.attributes,\r\n                    direction: getDirection(\r\n                        this.nodes[v.attributes[from]].attributes.position,\r\n                        this.nodes[v.attributes[to]].attributes.position\r\n                    )\r\n                }\r\n            })\r\n\r\n            return acc\r\n        }, {})\r\n    }\r\n\r\n    getBounds() {\r\n        return Object.keys(this.nodes)\r\n            .map(key => this.nodes[key].attributes.position)\r\n            .reduce(([minX, maxX, minY, maxY], [x, y]) => [\r\n                Math.min(minX, x), Math.max(maxX, x),\r\n                Math.min(minY, y), Math.max(maxY, y)\r\n            ], [Infinity, -Infinity, Infinity, -Infinity])\r\n    }\r\n\r\n    toArray() {\r\n        let [minX, maxX, minY, maxY] = this.getBounds()\r\n        if (minX > maxX || minY > maxY) return []\r\n\r\n        let diagram = Array(maxY - minY + 1).fill().map(_ => Array(maxX - minX + 1).fill(null))\r\n\r\n        for (let key of Object.keys(this.nodes)) {\r\n            let [x, y] = this.nodes[key].attributes.position\r\n\r\n            diagram[y - minY][x - minX] = {\r\n                node: this.nodes[key],\r\n                edges: this.edges[key] || []\r\n            }\r\n        }\r\n\r\n        return diagram\r\n    }\r\n\r\n    render() {\r\n        let options = this.props.options == null ? '' : `[${this.props.options}]`\r\n\r\n        return [\r\n            `\\\\begin{tikzcd}${options}`,\r\n\r\n            this.toArray().map(entries => entries.map(entry =>\r\n                entry == null ? ''\r\n                : [\r\n                    entry.node.attributes.value,\r\n                    ...entry.edges.map(e => renderEdge(e, this.props.co))\r\n                ].join(' ')\r\n            ).join(' & ')).join(' \\\\\\\\\\n'),\r\n\r\n            '\\\\end{tikzcd}'\r\n        ].join('\\n')\r\n    }\r\n}\r\n","import {Diagram, Node, Edge} from './components'\r\n\r\nfunction resolveComponents(vnode) {\r\n    if (vnode == null) return null\r\n\r\n    if (![Diagram, Node, Edge].includes(vnode.nodeName)) {\r\n        let props = {...vnode.attributes, children: vnode.children}\r\n\r\n        if ('render' in vnode.nodeName.prototype) {\r\n            return resolveComponents(new vnode.nodeName(props).render())\r\n        } else {\r\n            return resolveComponents(vnode.nodeName(props))\r\n        }\r\n    }\r\n\r\n    return {\r\n        ...vnode,\r\n        children: vnode.children.map(x => resolveComponents(x))\r\n    }\r\n}\r\n\r\nexport function renderToDiagram(vnode, co = false) {\r\n    let diagramNode = resolveComponents(vnode)\r\n\r\n    if (diagramNode == null || diagramNode.nodeName !== Diagram)\r\n        return null\r\n\r\n    return new Diagram({\r\n        ...diagramNode.attributes,\r\n        co: co !== !!diagramNode.attributes.co,\r\n        children: diagramNode.children\r\n    })\r\n}\r\n\r\nexport function render(vnode, co = false) {\r\n    return renderToDiagram(vnode, co).render()\r\n}\r\n\r\nexport function corender(vnode) {\r\n    return render(vnode, true)\r\n}\r\n"],"names":["h","nodeName","attributes","children","getChildren","reduce","acc","child","Array","push","key","getDirection","x1","y1","x2","y2","dx","dy","signs","map","Math","sign","directions","d","i","repeat","abs","join","renderEdge","vnode","co","direction","p","alt","needWrapChars","value","some","includes","c","w1","w2","valueArg","args","filter","x","Node","Edge","Component","props","Diagram","v","nodes","position","edges","from","to","Object","keys","minX","maxX","minY","maxY","y","min","max","Infinity","getBounds","diagram","fill","options","toArray","entries","entry","node","e","resolveComponents","prototype","render","renderToDiagram","diagramNode","corender"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAe,SAASA,CAAT,CAAWC,QAAX,EAAqBC,UAArB,EAA8C;sCAAVC,QAAU;gBAAA;;;QACrDC,cAAc,SAAdA,WAAc;eAAYD,SAASE,MAAT,CAAgB,UAACC,GAAD,EAAMC,KAAN,EAAgB;gBACtDA,iBAAiBC,KAArB,EAA4B;oBACpBC,IAAJ,8BAAYL,YAAYG,KAAZ,CAAZ;aADJ,MAEO;oBACCE,IAAJ,CAASF,KAAT;;;mBAGGD,GAAP;SAP0B,EAQ3B,EAR2B,CAAZ;KAAlB;;WAUO;0BAAA;oBAESJ,cAAc,EAFvB;aAGEA,cAAcA,WAAWQ,GAH3B;kBAION,YAAYD,QAAZ;KAJd;;;ACXJ,SAASQ,YAAT,cAA0C;;QAAnBC,EAAmB;QAAfC,EAAe;;;QAATC,EAAS;QAALC,EAAK;;QACjCC,EADiC,GACtBF,KAAKF,EADiB;QAC7BK,EAD6B,GACbF,KAAKF,EADQ;;QAElCK,QAAQ,CAACF,EAAD,EAAKC,EAAL,EAASE,GAAT,CAAaC,KAAKC,IAAlB,CAAZ;QACIC,aAAa,CAAC,CAAC,GAAD,EAAM,EAAN,EAAU,GAAV,CAAD,EAAiB,CAAC,GAAD,EAAM,EAAN,EAAU,GAAV,CAAjB,CAAjB;;WAEO,CAACN,EAAD,EAAKC,EAAL,EAASE,GAAT,CAAa,UAACI,CAAD,EAAIC,CAAJ;eAAUF,WAAWE,CAAX,EAAcN,MAAMM,CAAN,IAAW,CAAzB,EAA4BC,MAA5B,CAAmCL,KAAKM,GAAL,CAASH,CAAT,CAAnC,CAAV;KAAb,EAAwEI,IAAxE,CAA6E,EAA7E,CAAP;;;AAGJ,SAASC,UAAT,CAAoBC,KAApB,EAAuC;QAAZC,EAAY,uEAAP,KAAO;;QAC/BD,MAAM3B,UAAN,CAAiB6B,SAAjB,IAA8B,IAAlC,EAAwC,OAAO,EAAP;;QAEpCC,IAAI,CAACF,EAAD,KAAQ,CAAC,CAACD,MAAM3B,UAAN,CAAiB+B,GAA3B,GAAiC,GAAjC,GAAuC,EAA/C;QACIC,gBAAgB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAApB;;gBACeL,MAAM3B,UAAN,CAAiBiC,KAAjB,IAA0B,IAA1B,IACRD,cAAcE,IAAd,CAAmB;eAAKP,MAAM3B,UAAN,CAAiBiC,KAAjB,CAAuBE,QAAvB,CAAgCC,CAAhC,CAAL;KAAnB,CADQ,GAET,CAAC,GAAD,EAAM,GAAN,CAFS,GAEI,CAAC,EAAD,EAAK,EAAL,CAPgB;;QAK9BC,EAL8B;QAK1BC,EAL0B;;QAQ/BC,WAAWZ,MAAM3B,UAAN,CAAiBiC,KAAjB,IAA0B,IAA1B,SAAqCI,EAArC,GAA0CV,MAAM3B,UAAN,CAAiBiC,KAA3D,GAAmEK,EAAnE,SAAyER,CAAzE,GAA+E,IAA9F;QACIU,OAAO,CAAC,EAAD,EAAKD,QAAL,2BAAmBZ,MAAM3B,UAAN,CAAiBwC,IAAjB,IAAyB,EAA5C,GAAiDC,MAAjD,CAAwD;eAAKC,KAAK,IAAV;KAAxD,EAAwEjB,IAAxE,CAA6E,IAA7E,CAAX;;wBAEkBE,MAAM3B,UAAN,CAAiB6B,SAAnC,GAA+CW,IAA/C;;;AAGJ,AAAO,IAAMG,OAAO,SAAPA,IAAO,GAAM,EAAnB;AACP,AAAO,IAAMC,OAAO,SAAPA,IAAO,GAAM,EAAnB;;AAEP,IAAaC,SAAb;uBACgBC,KAAZ,EAAmB;;;aACVA,KAAL,GAAaA,KAAb;;;;;iCAGK;;;;;AAGb,IAAaC,OAAb;;;qBACgBD,KAAZ,EAAmB;;;qHACTA,KADS;;YAGX5C,cAAc,SAAdA,WAAc;mBAASyB,MAAM1B,QAAN,CAAeE,MAAf,CAAsB,UAACC,GAAD,EAAM4C,CAAN,EAAY;oBACrDA,KAAK,IAAT,EAAe,OAAO5C,GAAP;;oBAEX,CAACuC,IAAD,EAAOC,IAAP,EAAaT,QAAb,CAAsBa,EAAEjD,QAAxB,CAAJ,EAAuC;wBAC/BQ,IAAJ,CAASyC,CAAT;iBADJ,MAEO;wBACCzC,IAAJ,8BAAYL,YAAY8C,CAAZ,CAAZ;;;uBAGG5C,GAAP;aATuB,EAUxB,EAVwB,CAAT;SAAlB;;YAYIH,WAAWC,YAAY,MAAK4C,KAAjB,CAAf;;cAEKG,KAAL,GAAahD,SAASE,MAAT,CAAgB,UAACC,GAAD,EAAM4C,CAAN,EAAY;gBACjCA,EAAEjD,QAAF,KAAe4C,IAAf,IAAuB,CAACK,EAAExC,GAA1B,IAAiC,CAACwC,EAAEhD,UAAF,CAAakD,QAAnD,EACI,OAAO9C,GAAP;;gBAEA,EAAE4C,EAAExC,GAAF,IAASJ,GAAX,CAAJ,EAAqBA,IAAI4C,EAAExC,GAAN,IAAawC,CAAb,CAArB,KACK5C,IAAI4C,EAAExC,GAAN,iBACEJ,IAAI4C,EAAExC,GAAN,CADF;yCAGMJ,IAAI4C,EAAExC,GAAN,EAAWR,UADlB,EAEOgD,EAAEhD,UAFT;;;mBAMGI,GAAP;SAbS,EAcV,EAdU,CAAb;;cAgBK+C,KAAL,GAAalD,SAASE,MAAT,CAAgB,UAACC,GAAD,EAAM4C,CAAN,EAAY;gBACjCA,EAAEjD,QAAF,KAAe6C,IAAf,IAAuB,CAACI,EAAEhD,UAAF,CAAaoD,IAArC,IAA6C,CAACJ,EAAEhD,UAAF,CAAaqD,EAA/D,EACI,OAAOjD,GAAP;;wBAEa,CAAC0C,MAAMlB,EAAP,GAAY,CAAC,MAAD,EAAS,IAAT,CAAZ,GAA6B,CAAC,IAAD,EAAO,MAAP,CAJT;;gBAIhCwB,IAJgC;gBAI1BC,EAJ0B;;gBAMjC,EAAEL,EAAEhD,UAAF,CAAaoD,IAAb,KAAsBhD,GAAxB,CAAJ,EAAkCA,IAAI4C,EAAEhD,UAAF,CAAaoD,IAAb,CAAJ,IAA0B,EAA1B;;gBAE9BJ,EAAEhD,UAAF,CAAaoD,IAAb,CAAJ,EAAwB7C,IAAxB,cACOyC,CADP;yCAGWA,EAAEhD,UADT;+BAEeS,aACP,MAAKwC,KAAL,CAAWD,EAAEhD,UAAF,CAAaoD,IAAb,CAAX,EAA+BpD,UAA/B,CAA0CkD,QADnC,EAEP,MAAKD,KAAL,CAAWD,EAAEhD,UAAF,CAAaqD,EAAb,CAAX,EAA6BrD,UAA7B,CAAwCkD,QAFjC;;;;mBAOZ9C,GAAP;SAnBS,EAoBV,EApBU,CAAb;;;;;;oCAuBQ;;;mBACDkD,OAAOC,IAAP,CAAY,KAAKN,KAAjB,EACFhC,GADE,CACE;uBAAO,OAAKgC,KAAL,CAAWzC,GAAX,EAAgBR,UAAhB,CAA2BkD,QAAlC;aADF,EAEF/C,MAFE,CAEK;;oBAAEqD,IAAF;oBAAQC,IAAR;oBAAcC,IAAd;oBAAoBC,IAApB;;;oBAA4BjB,CAA5B;oBAA+BkB,CAA/B;;uBAAsC,CAC1C1C,KAAK2C,GAAL,CAASL,IAAT,EAAed,CAAf,CAD0C,EACvBxB,KAAK4C,GAAL,CAASL,IAAT,EAAef,CAAf,CADuB,EAE1CxB,KAAK2C,GAAL,CAASH,IAAT,EAAeE,CAAf,CAF0C,EAEvB1C,KAAK4C,GAAL,CAASH,IAAT,EAAeC,CAAf,CAFuB,CAAtC;aAFL,EAKA,CAACG,QAAD,EAAW,CAACA,QAAZ,EAAsBA,QAAtB,EAAgC,CAACA,QAAjC,CALA,CAAP;;;;qCAQM;6BACyB,KAAKC,SAAL,EADzB;;gBACDR,IADC;gBACKC,IADL;gBACWC,IADX;gBACiBC,IADjB;;gBAEFH,OAAOC,IAAP,IAAeC,OAAOC,IAA1B,EAAgC,OAAO,EAAP;;gBAE5BM,UAAU3D,MAAMqD,OAAOD,IAAP,GAAc,CAApB,EAAuBQ,IAAvB,GAA8BjD,GAA9B,CAAkC;uBAAKX,MAAMmD,OAAOD,IAAP,GAAc,CAApB,EAAuBU,IAAvB,CAA4B,IAA5B,CAAL;aAAlC,CAAd;;;;;;;qCAEgBZ,OAAOC,IAAP,CAAY,KAAKN,KAAjB,CAAhB,8HAAyC;wBAAhCzC,GAAgC;;8DACxB,KAAKyC,KAAL,CAAWzC,GAAX,EAAgBR,UAAhB,CAA2BkD,QADH;wBAChCR,CADgC;wBAC7BkB,CAD6B;;4BAG7BA,IAAIF,IAAZ,EAAkBhB,IAAIc,IAAtB,IAA8B;8BACpB,KAAKP,KAAL,CAAWzC,GAAX,CADoB;+BAEnB,KAAK2C,KAAL,CAAW3C,GAAX,KAAmB;qBAF9B;;;;;;;;;;;;;;;;;mBAMGyD,OAAP;;;;iCAGK;;;gBACDE,UAAU,KAAKrB,KAAL,CAAWqB,OAAX,IAAsB,IAAtB,GAA6B,EAA7B,SAAsC,KAAKrB,KAAL,CAAWqB,OAAjD,MAAd;;mBAEO,qBACeA,OADf,EAGH,KAAKC,OAAL,GAAenD,GAAf,CAAmB;uBAAWoD,QAAQpD,GAAR,CAAY;2BACtCqD,SAAS,IAAT,GAAgB,EAAhB,GACE,CACEA,MAAMC,IAAN,CAAWvE,UAAX,CAAsBiC,KADxB,2BAEKqC,MAAMnB,KAAN,CAAYlC,GAAZ,CAAgB;+BAAKS,WAAW8C,CAAX,EAAc,OAAK1B,KAAL,CAAWlB,EAAzB,CAAL;qBAAhB,CAFL,GAGAH,IAHA,CAGK,GAHL,CAFoC;iBAAZ,EAM5BA,IAN4B,CAMvB,KANuB,CAAX;aAAnB,EAMeA,IANf,CAMoB,SANpB,CAHG,EAWH,eAXG,EAYLA,IAZK,CAYA,IAZA,CAAP;;;;EAvFqBoB,SAA7B;;AC/BA,SAAS4B,iBAAT,CAA2B9C,KAA3B,EAAkC;QAC1BA,SAAS,IAAb,EAAmB,OAAO,IAAP;;QAEf,CAAC,CAACoB,OAAD,EAAUJ,IAAV,EAAgBC,IAAhB,EAAsBT,QAAtB,CAA+BR,MAAM5B,QAArC,CAAL,EAAqD;YAC7C+C,qBAAYnB,MAAM3B,UAAlB,IAA8BC,UAAU0B,MAAM1B,QAA9C,GAAJ;;YAEI,YAAY0B,MAAM5B,QAAN,CAAe2E,SAA/B,EAA0C;mBAC/BD,kBAAkB,IAAI9C,MAAM5B,QAAV,CAAmB+C,KAAnB,EAA0B6B,MAA1B,EAAlB,CAAP;SADJ,MAEO;mBACIF,kBAAkB9C,MAAM5B,QAAN,CAAe+C,KAAf,CAAlB,CAAP;;;;wBAKDnB,KADP;kBAEcA,MAAM1B,QAAN,CAAegB,GAAf,CAAmB;mBAAKwD,kBAAkB/B,CAAlB,CAAL;SAAnB;;;;AAIlB,AAAO,SAASkC,eAAT,CAAyBjD,KAAzB,EAA4C;QAAZC,EAAY,uEAAP,KAAO;;QAC3CiD,cAAcJ,kBAAkB9C,KAAlB,CAAlB;;QAEIkD,eAAe,IAAf,IAAuBA,YAAY9E,QAAZ,KAAyBgD,OAApD,EACI,OAAO,IAAP;;WAEG,IAAIA,OAAJ,cACA8B,YAAY7E,UADZ;YAEC4B,OAAO,CAAC,CAACiD,YAAY7E,UAAZ,CAAuB4B,EAFjC;kBAGOiD,YAAY5E;OAH1B;;;AAOJ,AAAO,SAAS0E,MAAT,CAAgBhD,KAAhB,EAAmC;QAAZC,EAAY,uEAAP,KAAO;;WAC/BgD,gBAAgBjD,KAAhB,EAAuBC,EAAvB,EAA2B+C,MAA3B,EAAP;;;AAGJ,AAAO,SAASG,QAAT,CAAkBnD,KAAlB,EAAyB;WACrBgD,OAAOhD,KAAP,EAAc,IAAd,CAAP;;;;;;;;;;;;"}